---
- name: Install ansible
  ansible.builtin.dnf:
    name: ansible
    state: present
  when: ansible_distribution == 'Rocky'

- name: Install git
  ansible.builtin.dnf:
    name: git
    state: present
  when: ansible_distribution == 'Rocky'

- name: Install certbot
  ansible.builtin.dnf:
    name: certbot
    state: present
  when: ansible_distribution == 'Rocky'

- name: Create cert path
  ansible.builtin.file:
    path: "/etc/letsencrypt/live/{{ ssl_cert }}"
    state: directory
  when: ansible_distribution == 'Rocky'

- name: Create Git repo path
  ansible.builtin.file:
    path: "/etc/ansible/git"
    state: directory
  when: ansible_distribution == 'Rocky'

- name: Create main playbook path
  ansible.builtin.file:
    path: "/etc/ansible/main_playbook"
    state: directory
  when: ansible_distribution == 'Rocky'

- name: Ansible Standalone playbooks path
  ansible.builtin.file:
    path: "etc/ansible/standalone_playbooks"
    state: directory
  when: ansible_distribution == 'Rocky'

- name: Ansible clone path
  ansible.builtin.file:
    path: "/home/{{ user_name }}/ansible_configs/git"
    state: directory
  when: ansible_distribution == 'Rocky'

- name: Clone Ansible Repo
  ansible.builtin.git:
    repo: https://github.com/MatthewDavidMiller/ansible_configuration.git
    dest: "/home/{{ user_name }}/ansible_configs/git/ansible_configuration"
  when: ansible_distribution == 'Rocky'

- name: Copy Ansible and standard role
  ansible.builtin.copy:
    src: /home/{{ user_name }}/ansible_configs/git/ansible_configuration/roles
    dest: /etc/ansible/main_playbook
  when: ansible_distribution == 'Rocky'

- name: Clone Dns Repo
  ansible.builtin.git:
    repo: https://github.com/MatthewDavidMiller/DNS-Server-Configuration.git
    dest: "/home/{{ user_name }}/ansible_configs/git/DNS-Server-Configuration"
  when: ansible_distribution == 'Rocky'

- name: Copy DNS role
  ansible.builtin.copy:
    src: /home/{{ user_name }}/ansible_configs/git/DNS-Server-Configuration/ansible/roles
    dest: /etc/ansible/main_playbook
  when: ansible_distribution == 'Rocky'

- name: Clone reverse proxy Repo
  ansible.builtin.git:
    repo: https://github.com/MatthewDavidMiller/reverse_proxy.git
    dest: "/home/{{ user_name }}/ansible_configs/git/reverse_proxy"
  when: ansible_distribution == 'Rocky'

- name: Copy reverse proxy role
  ansible.builtin.copy:
    src: /home/{{ user_name }}/ansible_configs/git/reverse_proxy/roles
    dest: /etc/ansible/main_playbook
  when: ansible_distribution == 'Rocky'

- name: Clone VPN Repo
  ansible.builtin.git:
    repo: https://github.com/MatthewDavidMiller/VPN-Server-Configuration.git
    dest: "/home/{{ user_name }}/ansible_configs/git/VPN-Server-Configuration"
  when: ansible_distribution == 'Rocky'

- name: Copy VPN role
  ansible.builtin.copy:
    src: /home/{{ user_name }}/ansible_configs/git/VPN-Server-Configuration/ansible/roles
    dest: /etc/ansible/main_playbook
  when: ansible_distribution == 'Rocky'

- name: Clone Nextcloud Repo
  ansible.builtin.git:
    repo: https://github.com/MatthewDavidMiller/nextcloud_ansible.git
    dest: "/home/{{ user_name }}/ansible_configs/git/nextcloud_ansible"
  when: ansible_distribution == 'Rocky'

- name: Copy Nextcloud role
  ansible.builtin.copy:
    src: /home/{{ user_name }}/ansible_configs/git/nextcloud_ansible/roles
    dest: /etc/ansible/main_playbook
  when: ansible_distribution == 'Rocky'

- name: Clone Router Repo
  ansible.builtin.git:
    repo: https://github.com/MatthewDavidMiller/Router-Configuration.git
    dest: "/home/{{ user_name }}/ansible_configs/git/Router-Configuration"
  when: ansible_distribution == 'Rocky'

- name: Copy Router role
  ansible.builtin.copy:
    src: /home/{{ user_name }}/ansible_configs/git/Router-Configuration/ansible/roles
    dest: /etc/ansible/main_playbook
  when: ansible_distribution == 'Rocky'

- name: Clone Vaultwarden Repo
  ansible.builtin.git:
    repo: https://github.com/MatthewDavidMiller/Vaultwarden_Ansible_Configuration.git
    dest: "/home/{{ user_name }}/ansible_configs/git/Vaultwarden_Ansible_Configuration"
  when: ansible_distribution == 'Rocky'

- name: Copy Vaultwarden role
  ansible.builtin.copy:
    src: /home/{{ user_name }}/ansible_configs/git/Vaultwarden_Ansible_Configuration/roles
    dest: /etc/ansible/main_playbook
  when: ansible_distribution == 'Rocky'

- name: Clone ApController Repo
  ansible.builtin.git:
    repo: https://github.com/MatthewDavidMiller/Access-Point-Controller-Configuration.git
    dest: "/home/{{ user_name }}/ansible_configs/git/APController_Ansible_Configuration"
  when: ansible_distribution == 'Rocky'

- name: Copy ApController role
  ansible.builtin.copy:
    src: /home/{{ user_name }}/ansible_configs/git/APController_Ansible_Configuration/ansible/roles
    dest: /etc/ansible/main_playbook
  when: ansible_distribution == 'Rocky'

- name: Clone Desktop Repo
  ansible.builtin.git:
    repo: https://github.com/MatthewDavidMiller/Desktop_Configuration.git
    dest: "/home/{{ user_name }}/ansible_configs/git/Desktop_Configuration"
  when: ansible_distribution == 'Rocky'

- name: Copy Desktop role
  ansible.builtin.copy:
    src: /home/{{ user_name }}/ansible_configs/git/Desktop_Configuration/roles
    dest: /etc/ansible/main_playbook
  when: ansible_distribution == 'Rocky'

- name: Certbot script
  ansible.builtin.template:
    src: generate_cert.j2
    dest: "/usr/local/bin/generate_cert.sh"
  when: ansible_distribution == 'Rocky'
